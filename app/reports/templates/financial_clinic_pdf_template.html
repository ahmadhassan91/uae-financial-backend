<!DOCTYPE html>
<html lang="{{ 'ar' if language == 'ar' else 'en' }}" dir="{{ 'rtl' if language == 'ar' else 'ltr' }}">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>
    {% if language == 'ar' %}تقرير الصحة المالية{% else %}Financial Health
    Report{% endif %}
  </title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    @page {
      size: A4;
      margin: 12mm;
    }

    body {
      font-family: "Poppins", Arial, sans-serif;
      background-color: #ffffff;
      color: #333333;
      line-height: 1.4;
      font-size: 12px;
    }

    .container {
      max-width: 100%;
      margin: 0 auto;
      padding: 12px;
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 14px;
      padding: 0;
    }

    .logo-left {
      height: 35px;
      object-fit: contain;
    }

    .logo-right {
      height: 38px;
      object-fit: contain;
    }

    /* Hero Section */
    .hero {
      text-align: center;
      margin-bottom: 12px;
    }

    .hero-title {
      font-size: 24px;
      font-weight: 600;
      color: #2d7a3e;
      margin-bottom: 8px;
      line-height: 1.2;
    }

    .hero-subtitle {
      font-size: 9px;
      color: #9ca3af;
      margin-bottom: 4px;
      line-height: 1.3;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Score Display */
    .score-section {
      text-align: center;
      margin: 16px 0;
      padding: 12px 14px;
      background-color: #ffffff;
    }

    .score-label {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .score-number {
      font-size: 56px;
      font-weight: 700;
      line-height: 1;
      margin-bottom: 14px;
    }

    .progress-bar {
      width: 100%;
      max-width: 350px;
      height: 10px;
      background-color: #e5e7eb;
      border-radius: 5px;
      position: relative;
      margin: 10px auto;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      border-radius: 5px;
      transition: width 0.3s ease;
      background-image: repeating-linear-gradient(45deg,
          transparent,
          transparent 8px,
          rgba(255, 255, 255, 0.1) 8px,
          rgba(255, 255, 255, 0.1) 16px);
    }

    /* Understanding Score Card */
    .understanding-card {
      margin: 14px auto;
      padding: 12px 14px;
      border: 0.5px solid #c2d1d9;
      border-radius: 6px;
      background-color: #ffffff;
      max-width: 100%;
    }

    .understanding-title {
      font-size: 11px;
      font-weight: 600;
      color: #1f2937;
      text-align: center;
      margin-bottom: 6px;
    }

    .score-bands {
      display: flex;
      width: 100%;
      border-radius: 20px;
      overflow: hidden;
      margin-bottom: 6px;
      height: 22px;
    }

    .score-band {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 9px;
    }

    .band-poor {
      background-color: #dc2626;
      border-top-left-radius: 20px;
      border-bottom-left-radius: 20px;
    }

    .band-fair {
      background-color: #f97316;
    }

    .band-good {
      background-color: #fbbf24;
    }

    .band-excellent {
      background-color: #10b981;
      border-top-right-radius: 20px;
      border-bottom-right-radius: 20px;
    }

    .band-labels {
      display: flex;
      justify-content: space-between;
      gap: 4px;
      margin-top: 5px;
    }

    .band-label {
      flex: 1;
      text-align: center;
    }

    .band-label-title {
      font-size: 8px;
      font-weight: 600;
      color: #4b5563;
      margin-bottom: 2px;
    }

    .band-label-desc {
      font-size: 7px;
      color: #9ca3af;
      line-height: 1.2;
    }

    /* Section Title */
    .section-title {
      font-size: 15px;
      font-weight: 600;
      color: #2d7a3e;
      text-align: center;
      margin: 14px 0 7px;
    }

    .section-subtitle {
      font-size: 9px;
      color: #9ca3af;
      text-align: center;
      margin-bottom: 10px;
    }

    /* Pillar Scores */
    .pillar-item {
      margin-bottom: 6px;
      padding-bottom: 5px;
      border-bottom: 0.5px solid #e5e7eb;
    }

    .pillar-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .pillar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .pillar-info {
      flex: 1;
      min-width: 0;
    }

    .pillar-title {
      font-size: 9px;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 2px;
    }

    .pillar-description {
      font-size: 8px;
      color: #9ca3af;
      line-height: 1.3;
    }

    .pillar-progress {
      flex-shrink: 0;
      width: 130px;
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
    }

    .pillar-progress-fill {
      height: 100%;
      background: #10b981;
      border-radius: 4px;
      transition: width 0.3s ease;
      background-image: repeating-linear-gradient(45deg,
          transparent,
          transparent 5px,
          rgba(255, 255, 255, 0.15) 5px,
          rgba(255, 255, 255, 0.15) 10px);
    }

    /* RTL Pillar Progress */
    .rtl .pillar-progress {
      margin-left: 0;
      margin-right: 12px;
      /* Replace gap */
    }

    .rtl .pillar-header {
      /* flex-direction: row-reverse; - Removed, let direction: rtl handle it */
    }

    /* Recommendations */
    .recommendations-card {
      background-color: #f9fafb;
      border: 0.5px solid #d1d5db;
      border-radius: 6px;
      padding: 12px 14px;
      margin: 10px 0;
    }

    .recommendations-title {
      font-size: 9px;
      font-weight: 600;
      color: #2d7a3e;
      margin-bottom: 6px;
    }

    .recommendation-item {
      margin-bottom: 4px;
      display: flex;
      /* gap: 5px; - Replaced with margin */
      align-items: flex-start;
    }

    .recommendation-item:last-child {
      margin-bottom: 0;
    }

    .recommendation-number {
      font-size: 8px;
      font-weight: 400;
      color: #4b5563;
      flex-shrink: 0;
      min-width: 12px;
      margin-right: 5px;
      /* LTR margin */
    }

    .rtl .recommendation-number {
      margin-right: 0;
      margin-left: 5px;
      /* RTL margin */
    }

    .recommendation-text {
      font-size: 8px;
      color: #4b5563;
      line-height: 1.5;
      /* Increased for Arabic */
    }

    .recommendation-category {
      font-weight: 600;
      color: #1f2937;
    }

    /* RTL Recommendations */
    .rtl .recommendation-item {
      /* flex-direction: row-reverse; - Removed */
    }

    /* Footer */
    .footer {
      margin-top: 12px;
      padding-top: 6px;
      border-top: 0.5px solid #e5e7eb;
      text-align: center;
    }

    .footer-logo {
      height: 28px;
      opacity: 0.9;
      margin-bottom: 4px;
    }

    .footer-text {
      font-size: 7px;
      color: #9ca3af;
      margin-top: 3px;
      line-height: 1.3;
    }

    /* Print Styles */
    @media print {
      body {
        print-color-adjust: exact;
        -webkit-print-color-adjust: exact;
      }

      .container {
        max-width: 100%;
        padding: 12px;
      }

      .pillar-item {
        page-break-inside: avoid;
      }

      .footer {
        page-break-inside: avoid;
      }
    }

    /* RTL Support */
    .rtl {
      direction: rtl;
      text-align: right;
      font-family: "Tajawal", "Almarai", "Arial", sans-serif;
      /* Arabic fonts */
    }

    .rtl .hero,
    .rtl .score-section,
    .rtl .understanding-title,
    .rtl .section-title,
    .rtl .section-subtitle {
      text-align: center;
    }

    .rtl .pillar-title,
    .rtl .pillar-description,
    .rtl .recommendations-title {
      text-align: right;
    }

    .rtl .pillar-header {
      gap: 0;
      /* Reset gap if used */
    }

    .rtl .pillar-info {
      margin-left: 12px;
      /* Add spacing between info and progress bar in RTL */
    }
  </style>
</head>

<body class="{{ 'rtl' if language == 'ar' else '' }}">
  <div class="container">
    <!-- Header with Logos -->
    <div class="header">
      <img src="https://res.cloudinary.com/dhujwbcor/image/upload/v1764332361/financial_clinic_nep6cd.png"
        alt="Financial Clinic" class="logo-left" />
      <img src="https://res.cloudinary.com/dhujwbcor/image/upload/v1764334328/logo_bhsixi.png" alt="National Bonds"
        class="logo-right" />
    </div>

    <!-- Hero Section -->
    <div class="hero">
      <h1 class="hero-title">
        {% if language == 'ar' %} إليك درجة صحتك المالية! {% else %} Here's
        your Financial Health Score! {% endif %}
      </h1>
      <p class="hero-subtitle">
        {% if language == 'ar' %} هذه لمحة سريعة، نظرة واضحة على مدى صحة
        أموالك اليوم. {% else %} This is your snapshot; a clear view of how
        healthy your finances are today. {% endif %}
      </p>
      <p class="hero-subtitle">
        {% if language == 'ar' %} تعكس نتيجتك كيفية أدائك عبر المجالات
        الرئيسية. {% else %} Your score reflects how you're doing across key
        areas. {% endif %}
      </p>
      <p class="hero-subtitle">
        {% if language == 'ar' %} استمر في تحسين عاداتك، وسوف تنمو رفاهيتك
        المالية بشكل أقوى مع مرور الوقت. {% else %} Keep improving your
        habits, and your financial wellbeing will grow stronger over time. {%
        endif %}
      </p>
    </div>

    <!-- Score Display -->
    <div class="score-section">
      <div class="score-label" style="color: {{ status_color }}">
        {{ status_label }}
      </div>
      <div class="score-number" style="color: {{ status_color }}">
        {{ total_score|round|int }}%
      </div>
      <div class="progress-bar">
        <div class="progress-fill" style="width: {{ total_score }}%; background-color: {{ status_color }};"></div>
      </div>
    </div>

    <!-- Understanding Your Score -->
    <div class="understanding-card">
      <h2 class="understanding-title">
        {% if language == 'ar' %}فهم نتيجتك{% else %}Understanding Your
        Score{% endif %}
      </h2>

      <div class="score-bands">
        <div class="score-band band-poor">1-29</div>
        <div class="score-band band-fair">30-59</div>
        <div class="score-band band-good">60-79</div>
        <div class="score-band band-excellent">85-100</div>
      </div>

      <div class="band-labels">
        <div class="band-label">
          <div class="band-label-title">
            {% if language == 'ar' %}يحتاج إلى تحسين{% else %}Needs
            Improvement{% endif %}
          </div>
          <div class="band-label-desc">
            {% if language == 'ar' %}ركز على بناء عادات مالية أساسية{% else
            %}Focus on building basic financial habits{% endif %}
          </div>
        </div>
        <div class="band-label">
          <div class="band-label-title">
            {% if language == 'ar' %}مقبول{% else %}Fair{% endif %}
          </div>
          <div class="band-label-desc">
            {% if language == 'ar' %}أساس جيد، مجال للنمو{% else %}Good
            foundation, room for growth{% endif %}
          </div>
        </div>
        <div class="band-label">
          <div class="band-label-title">
            {% if language == 'ar' %}جيد{% else %}Good{% endif %}
          </div>
          <div class="band-label-desc">
            {% if language == 'ar' %}صحة مالية قوية{% else %}Strong financial
            health{% endif %}
          </div>
        </div>
        <div class="band-label">
          <div class="band-label-title">
            {% if language == 'ar' %}ممتاز{% else %}Excellent{% endif %}
          </div>
          <div class="band-label-desc">
            {% if language == 'ar' %}رفاهية مالية متميزة{% else %}Outstanding
            financial wellness{% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Financial Pillar Scores -->
    <h2 class="section-title">
      {% if language == 'ar' %}درجات الركائز المالية{% else %}Financial Pillar
      Scores{% endif %}
    </h2>
    <p class="section-subtitle">
      {% if language == 'ar' %} أدائك عبر 7 مجالات رئيسية للصحة المالية {%
      else %} Your performance across the 7 key areas of financial health {%
      endif %}
    </p>

    {% for category_name, category_data in category_scores.items() %}
    <div class="pillar-item">
      <div class="pillar-header">
        <div class="pillar-info">
          <div class="pillar-title">
            {{ category_translations[category_name] }}
          </div>
          <div class="pillar-description">
            {{ category_descriptions[category_name] }}
          </div>
        </div>
        <div class="pillar-progress">
          <div class="pillar-progress-fill"
            style="width: {{ (category_data.score / category_data.max_possible * 100)|round|int }}%; background-color: {{ category_colors[category_name] }};">
          </div>
        </div>
      </div>
    </div>
    {% endfor %}

    <!-- Personalized Action Plan -->
    <h2 class="section-title">
      {% if language == 'ar' %}خطة عملك الشخصية{% else %}Your Personalized
      Action Plan{% endif %}
    </h2>
    <p class="section-subtitle">
      {% if language == 'ar' %} التغييرات الصغيرة تحدث فرقًا كبيرًا. إليك
      كيفية تقوية نتيجتك. {% else %} Small changes make big differences.
      Here's how to strengthen your score. {% endif %}
    </p>

    <div class="recommendations-card">
      <h3 class="recommendations-title">
        {% if language == 'ar' %}فئات التوصيات:{% else %}Recommendation
        Categories:{% endif %}
      </h3>

      {% if insights and insights|length > 0 %} {% for insight in insights[:5]
      %}
      <div class="recommendation-item">
        <div class="recommendation-number">
          {{ loop.index }}{% if language == 'ar' %}.{% endif %}
        </div>
        <div class="recommendation-text">
          <span class="recommendation-category">{{ insight.category_translated }}:</span>
          {{ insight.text }}
        </div>
      </div>
      {% endfor %} {% else %}
      <div class="recommendation-text" style="text-align: center">
        {% if language == 'ar' %} لا توجد توصيات. أنت تقوم بعمل رائع! {% else
        %} No recommendations. You're doing great! {% endif %}
      </div>
      {% endif %}
    </div>

    <!-- Footer -->
    <div class="footer">
      <img src="data:image/png;base64,{{ national_bonds_logo_base64 }}" alt="National Bonds" class="footer-logo" />
      <p class="footer-text">
        {% if language == 'ar' %} هذا التقرير لأغراض إعلامية فقط ولا يشكل
        نصيحة مالية. © {{ current_year }} السندات الوطنية. جميع الحقوق محفوظة.
        {% else %} This report is for informational purposes only and does not
        constitute financial advice. © {{ current_year }} National Bonds. All
        rights reserved. {% endif %}
      </p>
      <p class="footer-text" style="margin-top: 10px">
        {% if language == 'ar' %} للمزيد من المعلومات، قم بزيارة
        www.nationalbonds.ae {% else %} For more information, visit
        www.nationalbonds.ae {% endif %}
      </p>
    </div>
  </div>
</body>

</html>